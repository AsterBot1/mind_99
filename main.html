<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tenure — On-Chain Art Registry</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
  <style>
    :root {
      --canvas: #1a1814;
      --paper: #f2ebe3;
      --ink: #2c2824;
      --gold: #b8860b;
      --gold-dim: #8b6914;
      --frame: #4a4540;
      --muted: #6b6560;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--canvas);
      color: var(--paper);
      min-height: 100vh;
      line-height: 1.65;
    }

    .gallery-wrap {
      max-width: 64rem;
      margin: 0 auto;
      padding: clamp(1.5rem, 4vw, 3rem);
    }

    header {
      border-bottom: 1px solid var(--frame);
      padding-bottom: clamp(1.5rem, 3vw, 2.5rem);
      margin-bottom: clamp(2rem, 5vw, 3.5rem);
    }

    .title {
      font-family: 'Cormorant Garamond', serif;
      font-size: clamp(2.5rem, 8vw, 4rem);
      font-weight: 600;
      letter-spacing: 0.02em;
      color: var(--paper);
    }

    .subtitle {
      font-size: 0.95rem;
      color: var(--muted);
      margin-top: 0.5rem;
      font-weight: 400;
    }

    .wallet-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .btn {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.9rem;
      font-weight: 500;
      padding: 0.65rem 1.25rem;
      border: 1px solid var(--gold);
      background: transparent;
      color: var(--gold);
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.2s, color 0.2s;
    }

    .btn:hover {
      background: var(--gold);
      color: var(--canvas);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .addr {
      font-size: 0.8rem;
      color: var(--muted);
      word-break: break-all;
      max-width: 20rem;
    }

    .section {
      margin-bottom: 2.5rem;
    }

    .section-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--gold);
      margin-bottom: 1rem;
      letter-spacing: 0.03em;
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(16rem, 1fr));
      gap: 1.25rem;
    }

    .card {
      background: rgba(42, 39, 35, 0.8);
      border: 1px solid var(--frame);
      padding: 1.25rem;
      border-radius: 6px;
    }

    .card-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      margin-bottom: 0.35rem;
    }

    .card-value {
      font-size: 1.35rem;
      font-weight: 600;
      color: var(--paper);
    }

    .contract-input-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
      margin-bottom: 1rem;
    }

    .contract-input-row input {
      flex: 1;
      min-width: 18rem;
      padding: 0.6rem 0.9rem;
      font-size: 0.9rem;
      font-family: inherit;
      background: rgba(42, 39, 35, 0.9);
      border: 1px solid var(--frame);
      color: var(--paper);
      border-radius: 4px;
    }

    .contract-input-row input::placeholder {
      color: var(--muted);
    }

    .register-form {
      background: rgba(42, 39, 35, 0.8);
      border: 1px solid var(--frame);
      padding: 1.5rem;
      border-radius: 6px;
      max-width: 28rem;
    }

    .register-form .hint {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 0.5rem;
    }

    .register-form input {
      width: 100%;
      padding: 0.6rem 0.9rem;
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
      font-family: inherit;
      background: rgba(26, 24, 20, 0.8);
      border: 1px solid var(--frame);
      color: var(--paper);
      border-radius: 4px;
    }

    .status {
      font-size: 0.85rem;
      color: var(--gold-dim);
      margin-top: 1rem;
      min-height: 1.5em;
    }

    .status.error {
      color: #c75c5c;
    }

    .status.success {
      color: #5a9a6e;
    }

    footer {
      margin-top: 3rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--frame);
      font-size: 0.8rem;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <div class="gallery-wrap">
    <header>
      <h1 class="title">Tenure</h1>
      <p class="subtitle">Permanent art registry with exhibitions and provenance on-chain.</p>
      <div class="wallet-row">
        <button type="button" class="btn" id="connectBtn">Connect wallet</button>
        <span class="addr" id="walletAddr"></span>
      </div>
    </header>

    <section class="section">
      <h2 class="section-title">Contract</h2>
      <div class="contract-input-row">
        <input type="text" id="contractAddress" placeholder="Tenure contract address (e.g. 0x...)" />
        <button type="button" class="btn" id="refreshBtn">Refresh stats</button>
      </div>
    </section>

    <section class="section">
      <h2 class="section-title">Registry stats</h2>
      <div class="card-grid">
        <div class="card">
          <div class="card-label">Pieces registered</div>
          <div class="card-value" id="statPieces">—</div>
        </div>
        <div class="card">
          <div class="card-label">Exhibitions</div>
          <div class="card-value" id="statExhibitions">—</div>
        </div>
        <div class="card">
          <div class="card-label">Fee pool (ETH)</div>
          <div class="card-value" id="statFeePool">—</div>
        </div>
        <div class="card">
          <div class="card-label">Registration fee</div>
          <div class="card-value" id="statRegFee">—</div>
        </div>
      </div>
    </section>

    <section class="section">
      <h2 class="section-title">Register a piece</h2>
      <div class="register-form">
        <input type="text" id="manifestHash" placeholder="Manifest hash (32-byte hex, e.g. 0x1234...)" />
        <p class="hint">Use a keccak256 hash of your artwork manifest (IPFS hash, metadata JSON, etc.). Must be 32 bytes (0x + 64 hex chars).</p>
        <button type="button" class="btn" id="registerBtn" style="margin-top: 0.5rem;">Register piece (pay fee)</button>
      </div>
      <p class="status" id="txStatus"></p>
    </section>

    <footer>
      Tenure: on-chain art registry with exhibition slots and fee pool. Deploy the contract and paste its address above to view stats and register pieces.
    </footer>
  </div>

  <script>
    (function () {
      const TENURE_ABI = [
        'function pieceCount() view returns (uint256)',
        'function exhibitionCount() view returns (uint256)',
        'function feePoolBalance() view returns (uint256)',
        'function registrationFeeWei() view returns (uint256)',
        'function registerPiece(bytes32 manifestHash) payable',
        'function getPiecesByHolder(address) view returns (uint256[])',
        'function getPiece(uint256) view returns (address, bytes32, uint256, bool)'
      ];

      let provider = null;
      let signer = null;

      const connectBtn = document.getElementById('connectBtn');
      const walletAddr = document.getElementById('walletAddr');
      const contractAddress = document.getElementById('contractAddress');
      const refreshBtn = document.getElementById('refreshBtn');
      const statPieces = document.getElementById('statPieces');
      const statExhibitions = document.getElementById('statExhibitions');
      const statFeePool = document.getElementById('statFeePool');
      const statRegFee = document.getElementById('statRegFee');
      const manifestHash = document.getElementById('manifestHash');
      const registerBtn = document.getElementById('registerBtn');
      const txStatus = document.getElementById('txStatus');

      function setStatus(msg, type) {
        txStatus.textContent = msg;
        txStatus.className = 'status' + (type ? ' ' + type : '');
      }

      async function connect() {
        if (typeof window.ethereum === 'undefined') {
          setStatus('No wallet found. Install MetaMask or another Web3 wallet.', 'error');
          return;
        }
        try {
          provider = new ethers.BrowserProvider(window.ethereum);
          await provider.send('eth_requestAccounts', []);
          signer = await provider.getSigner();
          const addr = await signer.getAddress();
          walletAddr.textContent = addr.slice(0, 6) + '…' + addr.slice(-4);
          connectBtn.textContent = 'Connected';
          connectBtn.disabled = true;
          setStatus('', '');
        } catch (e) {
          setStatus('Connection failed: ' + (e.message || e), 'error');
        }
      }

      function getContract() {
        const addr = (contractAddress.value || '').trim();
        if (!addr || !ethers.isAddress(addr)) return null;
        if (!provider) return null;
        return new ethers.Contract(addr, TENURE_ABI, provider);
      }

      function getContractWithSigner() {
        const addr = (contractAddress.value || '').trim();
        if (!addr || !ethers.isAddress(addr)) return null;
        if (!signer) return null;
        return new ethers.Contract(addr, TENURE_ABI, signer);
      }

      async function refreshStats() {
        const c = getContract();
        if (!c) {
          statPieces.textContent = '—';
          statExhibitions.textContent = '—';
          statFeePool.textContent = '—';
          statRegFee.textContent = '—';
          return;
        }
        try {
          const [pieces, exhibitions, feePool, regFee] = await Promise.all([
            c.pieceCount(),
            c.exhibitionCount(),
            c.feePoolBalance(),
            c.registrationFeeWei()
          ]);
          statPieces.textContent = pieces.toString();
          statExhibitions.textContent = exhibitions.toString();
          statFeePool.textContent = ethers.formatEther(feePool);
          statRegFee.textContent = ethers.formatEther(regFee) + ' ETH';
        } catch (e) {
          statPieces.textContent = '—';
          statExhibitions.textContent = '—';
          statFeePool.textContent = '—';
          statRegFee.textContent = '—';
